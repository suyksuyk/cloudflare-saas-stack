# D1 æ•°æ®åº“å¿«é€Ÿæ“ä½œå¡ç‰‡

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
- **æœ¬åœ°å¼€å‘**ï¼šæ“ä½œ `.wrangler/state/v3/d1/` ä¸‹çš„ SQLite æ–‡ä»¶
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€šè¿‡ REST API æ“ä½œè¿œç¨‹ D1 æ•°æ®åº“
- **ç¯å¢ƒåˆ‡æ¢**ï¼šé€šè¿‡ `NODE_ENV` ç¯å¢ƒå˜é‡æ§åˆ¶

## âš¡ å¸¸ç”¨å‘½ä»¤

### ğŸ”§ ç”Ÿæˆè¿ç§»
```bash
bun run db:generate
```

### ğŸ“¦ åº”ç”¨è¿ç§»
```bash
# æœ¬åœ°å¼€å‘
bun run db:migrate:dev

# ç”Ÿäº§ç¯å¢ƒ
bun run db:migrate:prod
```

### ğŸ‘€ æŸ¥çœ‹æ•°æ®åº“
```bash
# æœ¬åœ°æ•°æ®åº“
bun run db:studio:dev

# ç”Ÿäº§æ•°æ®åº“
bun run db:studio:prod
```

## ğŸ”‘ ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€çš„ä¸‰ä¸ªå˜é‡
```env
CLOUDFLARE_D1_ACCOUNT_ID=ä½ çš„è´¦æˆ·ID
DATABASE=ä½ çš„æ•°æ®åº“ID  
CLOUDFLARE_D1_API_TOKEN=ä½ çš„APIä»¤ç‰Œ
```

### è·å–æ–¹å¼
1. **Account ID**ï¼šCloudflare Dashboard å³ä¾§è¾¹æ 
2. **Database ID**ï¼šD1 æ•°æ®åº“è¯¦æƒ…é¡µ
3. **API Token**ï¼šProfile â†’ API Tokens â†’ Create Token

## ğŸ—ï¸ æ–‡ä»¶ç»“æ„
```
.wrangler/state/v3/d1/     # æœ¬åœ° SQLite æ–‡ä»¶
drizzle/                   # è¿ç§»æ–‡ä»¶
src/server/db/schema.ts    # æ•°æ®åº“è¡¨ç»“æ„
wrangler.toml              # D1 é…ç½®
.env                       # ç¯å¢ƒå˜é‡
```

## ğŸš¨ å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| æ‰¾ä¸åˆ° .sqlite æ–‡ä»¶ | å…ˆè¿è¡Œ `bun run dev` |
| 403 Forbidden | æ£€æŸ¥ API Token æƒé™ |
| è¿ç§»å¤±è´¥ | æ‰‹åŠ¨æ‰§è¡Œ `wrangler d1 execute` |
| ç¯å¢ƒå˜é‡æ— æ•ˆ | æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ |

## ğŸ”„ å·¥ä½œæµç¨‹

### å¼€å‘é˜¶æ®µ
1. ä¿®æ”¹ `schema.ts`
2. `bun run db:generate`
3. `bun run db:migrate:dev`
4. `bun run dev`

### éƒ¨ç½²é˜¶æ®µ
1. `bun run db:migrate:prod`
2. `bun run build:cf`
3. `bun run deploy`

## ğŸ’¡ å…³é”®è¦ç‚¹
- æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒæ“ä½œä¸åŒçš„æ•°æ®åº“
- ç¯å¢ƒå˜é‡æ˜¯è¿æ¥ç”Ÿäº§ç¯å¢ƒçš„å…³é”®
- è¿ç§»æ–‡ä»¶éœ€è¦å…ˆåº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒå†éƒ¨ç½²ä»£ç 
- æ°¸è¿œä¸è¦æäº¤ `.env` æ–‡ä»¶åˆ° Git
